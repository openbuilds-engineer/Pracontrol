module.exports = class SerialBusy extends WebComponentAbstract {
  init() {
    defineEvent('deviceOk', 'Device ok, listen only', 'Serial buffer')
    defineEvent('deviceBusy', 'Device busy, listen only', 'Serial buffer')
    
    self.on('connected', e => setImmediate(() => self.emit('serialDirectWrite', { data: 'G4\n' })))
    
    self.on('serialDirectWrite', e => self.emit('deviceBusy'))
    self.on('serialData', e => e.detail.data.substr(0, 2) == 'ok' && self.emit('deviceOk'))
    
    self.on('deviceReset', e => self.emit('deviceOk'))
    self.on('disconnect', e => self.emit('deviceBusy'))
  }
}
